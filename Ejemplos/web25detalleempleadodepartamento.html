<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="../js/jquery-3.7.1.js"></script>
</head>
<body>
    <h1>Maestro detalle empleados departamentos</h1>
    <ul id="dept"></ul>
    <table id="tabla">
        <thead>
            <tr>
                <th>Apellido</th>
                <th>Oficio</th>
                <th>Salario</th>
                <th>Departamento</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>

    <script>
        let url="https://apicruddepartamentospgs.azurewebsites.net/";
        let url2="https://apiempleadosspgs.azurewebsites.net/";
        $(document).ready(function(){
            cargarDepartamentos();
        })

        function cargarDepartamentos() {
    var html = "";
    var request = "webresources/departamentos";

    $.getJSON(url + request, function(data) {
        console.log("leyendo");

        $("#dept").html("");

        $.each(data, function(i, dept) {
            var li = $("<li>");
            var boton = $("<button>", {
                "text": "Empleados",
                "value": dept.numero
            });

            li.text(dept.nombre + " "); 
            li.append(boton); 
            $("#dept").append(li); 

            boton.click(function() {
                var id = $(this).val();
                console.log(id);

                var request2 = "api/Empleados/EmpleadosDepartamento/" + id;

                $.getJSON(url2 + request2, function(data) {
                    console.log("leyendo info");
                    console.log(data);

                    html = ""; 

                    $.each(data, function(i, emp) {
                        html += "<tr><td>" + emp.apellido + "</td>" +
                                "<td>" + emp.oficio + "</td>" +
                                "<td>" + emp.salario + "</td>" +
                                "<td>" + emp.departamento + "</td></tr>";
                    });

                    $("#tabla tbody").html(html);
                });
            });
        });
    });
}

    </script>
</body>
</html>